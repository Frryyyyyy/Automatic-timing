<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>45åˆ†é’Ÿä¸“æ³¨å™¨ Â· ç‹¬ç«‹æ’¤é”€</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: system-ui, 'Segoe UI', Roboto, Arial, sans-serif;
        }
        body {
            background: linear-gradient(145deg, #f6f9fc 0%, #e9f0f5 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .card {
            max-width: 1100px;
            width: 100%;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(8px);
            box-shadow: 0 20px 35px -8px rgba(0,20,40,0.25);
            border-radius: 32px;
            padding: 30px 30px 40px;
            border: 1px solid rgba(255,255,255,0.5);
        }
        h2 {
            font-weight: 600;
            font-size: 1.9rem;
            margin-top: 0;
            margin-bottom: 12px;
            color: #0a3143;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
            border-bottom: 3px solid #2c7da0;
            padding-bottom: 15px;
        }
        .task-grid {
            display: flex;
            flex-direction: column;
            gap: 18px;
            margin: 25px 0 10px;
        }
        .task-row {
            background: white;
            border-radius: 20px;
            padding: 16px 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            border: 1px solid #e2ecf0;
            transition: all 0.15s;
        }
        .task-desc {
            display: flex;
            align-items: baseline;
            gap: 12px;
            flex: 2 1 240px;
        }
        .task-icon {
            background: #1e4a5f;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }
        .task-text {
            font-size: 1.2rem;
            font-weight: 500;
            color: #0b3b4a;
            word-break: break-word;
        }
        .time-stamp {
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            background: #f2f7fa;
            padding: 8px 16px;
            border-radius: 40px;
            font-size: 0.85rem;
            color: #1c6a7a;
            letter-spacing: 0.5px;
            border: 1px solid #cbdbe2;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin: 6px 0;
            white-space: nowrap;
        }
        .btn-group {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: flex-end;
            flex: 1 0 320px;
        }
        .action-btn {
            background: #1e6f8c;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 0.98rem;
            padding: 10px 20px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 0 #0e3b4a, 0 8px 16px rgba(0,60,80,0.1);
            transition: all 0.05s linear;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
            letter-spacing: 0.6px;
        }
        .action-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #0e3b4a, 0 10px 20px rgba(0,60,80,0.1);
        }
        .action-btn:disabled {
            background: #9bb8c4;
            box-shadow: 0 4px 0 #50707a;
            transform: translateY(2px);
            cursor: not-allowed;
            opacity: 0.8;
            pointer-events: none;
            color: #edf2f4;
        }
        /* æ’¤é”€æŒ‰é’®æ ·å¼ â€” æ¸…æ–°ä¸­æ€§ */
        .cancel-btn {
            background: #cedfe4;
            border: 1px solid #a0b9c2;
            color: #1e4e5c;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 10px 18px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 5px 0 #899ca3, 0 6px 12px rgba(0,0,0,0.04);
            transition: all 0.05s linear;
            cursor: pointer;
        }
        .cancel-btn:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #6d878e, 0 8px 16px rgba(0,0,0,0.04);
        }
        .cancel-btn:hover {
            background: #e2edf2;
            border-color: #8db3bf;
        }
        .reset-hint {
            margin-top: 35px;
            padding: 16px 20px;
            background: #e1f0f4;
            border-radius: 60px;
            color: #14515f;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.95rem;
            border: 1px dashed #2a7f8c;
        }
        .badge {
            background: #0e4f5e;
            color: white;
            padding: 5px 18px;
            border-radius: 50px;
            font-weight: 500;
        }
        .footer {
            margin-top: 10px;
            text-align: right;
            color: #3a6e7c;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="card">
        <h2>â³ ä¸“æ³¨Â·ç‹¬ç«‹æ’¤é”€ç‰ˆ</h2>
        <div class="task-grid" id="taskGrid"></div>

        <div class="reset-hint">
            <span style="display:flex; gap:6px;">ğŸ§¹ æ¯ä¸€è¡Œé…æœ‰ã€å–æ¶ˆã€‘æŒ‰é’®ï¼Œç‚¹å‡»åç«‹å³è§£é™¤å†·å´ã€æ¸…é™¤æ—¶é—´è®°å½•</span>
            <span class="badge" id="globalClock">â²ï¸ åŠ è½½ä¸­...</span>
        </div>
        <div class="footer">
            ğŸ•’ æ—¶é—´æ ¼å¼ï¼š<strong>æœˆ-æ—¥ æ—¶-åˆ†-ç§’</strong> Â· å–æ¶ˆåæŒ‰é’®ç«‹å³æ¢å¤ã€æ—¶é—´æˆ³æ¸…ç©º
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            const TASKS = [
                'ğŸ“‹ æ’°å†™é¡¹ç›®éœ€æ±‚æ–‡æ¡£',
                'ğŸ¨ è®¾è®¡ç”¨æˆ·ç•Œé¢åŸå‹',
                'ğŸ› ï¸ ä¿®å¤ç™»å½•æ¨¡å—ç¼ºé™·',
                'ğŸ§ª æ‰§è¡Œé›†æˆæµ‹è¯•ç”¨ä¾‹',
                'ğŸ“Š åˆ†ææ€§èƒ½ç›‘æ§æ•°æ®',
                'ğŸ“ æ•´ç†å‘¨æŠ¥åŠè®¡åˆ’'
            ];

            // å­˜å‚¨æ¯ä¸ªæŒ‰é’®çš„å¤±æ•ˆæˆªæ­¢æ—¶é—´æˆ³ (æ¯«ç§’) , 0 è¡¨ç¤ºæ²¡æœ‰æ¿€æ´»
            let disabledUntil = new Array(6).fill(0);
            let timerInterval = null;

            const grid = document.getElementById('taskGrid');

            // ----- æ ¼å¼åŒ–æ—¶é—´: æœˆ-æ—¥ æ—¶-åˆ†-ç§’ (ä¸¤ä½æ•°) -----
            function formatDateTime(date) {
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                return `${month}-${day} ${hours}-${minutes}-${seconds}`;
            }

            // ----- å®Œå…¨é‡æ–°æ¸²æŸ“æ‰€æœ‰è¡Œï¼ŒåŸºäºå½“å‰çŠ¶æ€ + localStorageè®°å½•çš„æ—¶é—´æ–‡æœ¬ -----
            function renderRows() {
                let html = '';
                const now = Date.now();

                for (let i = 0; i < TASKS.length; i++) {
                    const taskDesc = TASKS[i];
                    const until = disabledUntil[i];
                    const isDisabled = (until > now);

                    // è¯»å–è®°å½•çš„æ—¶é—´å­—ç¬¦ä¸²ï¼ˆå¦‚æœæœ‰ï¼‰
                    const storageKey = `task_timestamp_${i}`;
                    let savedTimeStr = localStorage.getItem(storageKey) || '';
                    let displayTime = savedTimeStr;  // å¯èƒ½ä¸ºç©ºå­—ç¬¦ä¸²

                    // ---- æ„å»ºè¡Œ ----
                    html += `<div class="task-row" data-row-index="${i}">`;
                    
                    // å·¦ä¾§æè¿°åŒº
                    html += `<div class="task-desc">`;
                    html += `<span class="task-icon">${i + 1}</span>`;
                    html += `<span class="task-text">${taskDesc}</span>`;
                    html += `</div>`;

                    // å³ä¾§æŒ‰é’®ç»„ï¼šæ—¶é—´æˆ³ + å¼€å§‹æŒ‰é’® + å–æ¶ˆæŒ‰é’®
                    html += `<div class="btn-group">`;

                    // æ—¶é—´æˆ³å±•ç¤º
                    if (displayTime) {
                        html += `<span class="time-stamp">ğŸ•’ ${displayTime}</span>`;
                    } else {
                        html += `<span class="time-stamp" style="color:#6f9aa7; background:#e7f0f3;">â±ï¸ æœªå¼€å§‹</span>`;
                    }

                    // ----- å¼€å§‹ä»»åŠ¡æŒ‰é’®ï¼ˆä¸»æŒ‰é’®ï¼‰-----
                    html += `<button class="action-btn start-btn" data-id="${i}" ${isDisabled ? 'disabled' : ''}>`;
                    if (isDisabled) {
                        const remainMs = until - now;
                        const remainMin = Math.floor(remainMs / 60000);
                        const remainSec = Math.floor((remainMs % 60000) / 1000);
                        html += `â³ å†·å´ä¸­ (${remainMin}åˆ†${remainSec}ç§’)`;
                    } else {
                        html += `âœ… å¼€å§‹ä»»åŠ¡`;
                    }
                    html += `</button>`;

                    // ----- å–æ¶ˆæŒ‰é’®ï¼ˆæ’¤é”€ï¼‰ï¼šä»»ä½•æ—¶å€™éƒ½å¯è§ï¼Œç‚¹å‡»åæ¸…é™¤çŠ¶æ€ã€æ—¶é—´è®°å½•ã€è§£é™¤å†·å´ -----
                    html += `<button class="cancel-btn cancel-btn-style" data-cancel-id="${i}">`;
                    html += `âŒ å–æ¶ˆ`;
                    html += `</button>`;

                    html += `</div>`; // btn-group
                    html += `</div>`; // task-row
                }
                grid.innerHTML = html;
            }

            // ----- æŒä¹…åŒ–å¤±æ•ˆæˆªæ­¢æ—¶é—´ï¼ˆç”¨äºåˆ·æ–°åæ¢å¤å†·å´ï¼‰-----
            function persistExpiry() {
                for (let i = 0; i < TASKS.length; i++) {
                    const expireKey = `task_expire_${i}`;
                    if (disabledUntil[i] > 0) {
                        localStorage.setItem(expireKey, disabledUntil[i].toString());
                    } else {
                        localStorage.removeItem(expireKey);
                    }
                }
            }

            // ----- ä» localStorage åŠ è½½æŒä¹…åŒ–çŠ¶æ€ -----
            function loadPersistedState() {
                const now = Date.now();
                for (let i = 0; i < TASKS.length; i++) {
                    // å°è¯•åŠ è½½å¤±æ•ˆæˆªæ­¢æ—¶é—´
                    const expireKey = `task_expire_${i}`;
                    const expire = localStorage.getItem(expireKey);
                    if (expire) {
                        const expireTime = parseInt(expire, 10);
                        if (!isNaN(expireTime) && expireTime > now) {
                            disabledUntil[i] = expireTime;
                        } else {
                            disabledUntil[i] = 0;
                            localStorage.removeItem(expireKey);
                            // ä½†ä¿ç•™æ—¶é—´æˆ³æ–‡æœ¬ï¼ˆä½œä¸ºå†å²è®°å½•ï¼Œä½†æŒ‰é’®å¯ç”¨ï¼‰ã€‚æˆ‘ä»¬ä¿ç•™timestampã€‚
                        }
                    } else {
                        disabledUntil[i] = 0;
                    }

                    // å…¼å®¹æ—§æ•°æ®ï¼šå¦‚æœæ²¡æœ‰timestamp_keyï¼Œé‚£å°±ä¸æ˜¾ç¤ºæ—¶é—´ï¼›å¦‚æœæœ‰expireä½†æ— timestampï¼Ÿä¿ç•™timestampä¸åˆ é™¤ã€‚
                }
            }

            // ----- æ¸…é™¤æŸä¸€è¡Œçš„æ‰€æœ‰çŠ¶æ€ï¼ˆæ’¤é”€æ“ä½œï¼‰-----
            function cancelTask(index) {
                if (index === undefined || index === null || index < 0 || index >= TASKS.length) return;

                // 1. æ¸…é™¤å¤±æ•ˆæˆªæ­¢æ—¶é—´
                disabledUntil[index] = 0;

                // 2. ç§»é™¤ localStorage ä¸­çš„æ—¶é—´è®°å½• ä»¥åŠ å¤±æ•ˆæˆªæ­¢key
                const timeKey = `task_timestamp_${index}`;
                localStorage.removeItem(timeKey);
                const expireKey = `task_expire_${index}`;
                localStorage.removeItem(expireKey);

                // 3. é‡æ–°æ¸²æŸ“ (æŒ‰é’®ç«‹å³å¯ç”¨ï¼Œæ—¶é—´æˆ³æ¶ˆå¤±)
                renderRows();
                updateGlobalClock();
            }

            // ----- å¤„ç†ã€å¼€å§‹ä»»åŠ¡ã€‘ç‚¹å‡»-----
            function handleStartClick(index) {
                const now = Date.now();
                // åŒé‡éªŒè¯ï¼šæ˜¯å¦å·²è¢«ç¦ç”¨
                if (disabledUntil[index] > now) return;

                // è®°å½•å½“å‰æ—¶é—´å¹¶æ ¼å¼åŒ–
                const clickDate = new Date();
                const formatted = formatDateTime(clickDate);

                // ä¿å­˜æ—¶é—´æˆ³åˆ° localStorage
                const storageKey = `task_timestamp_${index}`;
                localStorage.setItem(storageKey, formatted);

                // è®¾ç½®å†·å´æˆªæ­¢æ—¶é—´ï¼š45åˆ†é’Ÿ = 45*60*1000
                disabledUntil[index] = now + 45 * 60 * 1000;

                // æŒä¹…åŒ–æˆªæ­¢æ—¶é—´
                persistExpiry();

                // é‡æ–°æ¸²æŸ“
                renderRows();
                updateGlobalClock();
            }

            // ----- å…¨å±€äº‹ä»¶ä»£ç†ï¼ˆåŒæ—¶å¤„ç† å¼€å§‹æŒ‰é’® å’Œ å–æ¶ˆæŒ‰é’®ï¼‰-----
            function handleGridClick(e) {
                let target = e.target;
                while (target && target !== grid) {
                    
                    // 1. å¼€å§‹æŒ‰é’® (ç±»ååŒ…å« start-btn)
                    if (target.tagName === 'BUTTON' && target.classList.contains('start-btn')) {
                        const id = target.getAttribute('data-id');
                        if (id !== null) {
                            const idx = parseInt(id, 10);
                            if (!isNaN(idx)) {
                                e.preventDefault?.();
                                handleStartClick(idx);
                            }
                        }
                        return; // é˜²æ­¢åŒæ—¶è§¦å‘å–æ¶ˆ
                    }

                    // 2. å–æ¶ˆæŒ‰é’® (ç±»ååŒ…å« cancel-btn-style æˆ– data-cancel-id å±æ€§)
                    if (target.tagName === 'BUTTON' && target.classList.contains('cancel-btn-style')) {
                        const cancelId = target.getAttribute('data-cancel-id');
                        if (cancelId !== null) {
                            const idx = parseInt(cancelId, 10);
                            if (!isNaN(idx)) {
                                e.preventDefault?.();
                                cancelTask(idx);
                            }
                        }
                        return;
                    }
                    target = target.parentNode;
                }
            }

            // ----- æ»´ç­”è®¡æ—¶å™¨ï¼šæ¯ç§’é‡ç»˜ï¼Œå¤„ç†è¿‡æœŸï¼ŒæŒä¹…åŒ–-----
            function tick() {
                const now = Date.now();
                let needStateChange = false;
                for (let i = 0; i < disabledUntil.length; i++) {
                    if (disabledUntil[i] > 0 && disabledUntil[i] <= now) {
                        disabledUntil[i] = 0;
                        localStorage.removeItem(`task_expire_${i}`);
                        needStateChange = true;
                    }
                }
                if (needStateChange) {
                    persistExpiry();
                }
                // æ— è®ºå¦‚ä½•éƒ½é‡ç»˜ï¼ˆåˆ·æ–°æŒ‰é’®ä¸Šçš„å€’è®¡æ—¶æ•°å­—ï¼‰
                renderRows();
                updateGlobalClock();
            }

            // ----- æ›´æ–°å³ä¸Šè§’æ—¶é—´-----
            function updateGlobalClock() {
                const el = document.getElementById('globalClock');
                if (el) {
                    const now = new Date();
                    el.innerText = `ğŸ“… ${formatDateTime(now)}`;
                }
            }

            // ----- åˆå§‹åŒ–-----
            function init() {
                loadPersistedState();
                renderRows();
                updateGlobalClock();

                if (grid) {
                    grid.addEventListener('click', handleGridClick);
                }

                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(tick, 500);
            }

            init();

            // é¡µé¢å…³é—­å‰æŒä¹…åŒ–ä¸€æ¬¡
            window.addEventListener('beforeunload', function() {
                persistExpiry();
            });
        })();
    </script>
</body>
</html>